# St-Onge et al. Fingerprinting through the lifespan (2022)

This repo contains all the code used for the analyses in the paper. The code was developped in Python, R and bash.

**Note:** The script were developped, most of the time, to be launched directly from the command-line. This offered time savings during the scientific writing process. However, this comes at the cost of a lack of flexibility for future users as functions used for fingerprinting are hard to import and use.

I am currently working on adapting most scripts into a fully useable Python package which will allow for more flexibility for users. 

**Generally**:
- Python was used to compute measures (fingerprint identification accuracy, self-identifiability, others-identifiability)
- R was used to compute statistics and plot graphs
- Bash was used to launch both Python and R processes from the command-line

----
**Contents**
- General
    - Python `requirements.txt` file
    Python was used for many analyses. The `requirements.txt` file output by the virtual
    environment is made available in `requirements/requirements.txt`
    - R requirements
    R doesn't allow a seemless requirements file like Python does. R, R studio and packages versions are available in the article.
    R script is used to launch packages from the command-line and requires the file to have executable permissions. The R package `argparse` is used to mimic Python's command-line argument capabilities.

- Fingerprinting analysis
    - Python scripts
        - `fingerprinting/python/fingerprinting.py`: Main script to use to do compute the fingerprinting measures. Note that the acronyms output by the script do not match the article: `fpc` refers to **self-identifiability** while `asc` refers to **others-identifiability**. This is due to terms changing in the last version of the article, and will be corrected in a later script version.
        - `fingerprinting/python/merge_fpc_frames.py`: Simple optional script merging all the spreadsheets generated by the fingerprinting script if users are using multiple networks and modalities. It mostly just concatenates the spreadsheets in pandas.
        - `fingerprinting/python/rev_id_by_age.py`: Only script without command-line functionalities. Following revision of the article, we added an analysis where we use our sliding-window approach to compute identifiability by age windows. The script is commented, but a better version of this analysis will be made available later.
    - R scripts
        - `fingerprinting/r/fpc_iden.R`: Computes and return the fingerprint identification accuracy for each network for a given pair of modalities; returns a ggplot bar plot with the network names and returns a spreadsheet containing the actual percentages with confidence intervals. Currently forced to used Schaefer or Power's parcellations.
        - `fingerprinting/r/fpc_age.R`: Computes and return self- and others-identifiability's association with age for each network for a given pair of modalities. This script is **very** rigid and based specifically on our study. It outputs ggplot scatterplots for each network, merged in a single .png object, and assumes a non-linear relationship between age and identifiability measures. Under the hood, it also outputs the `summary(lm)` for the full model with covariates and bootstrapping results for every single network in separate `.txt`. 
    - Bash scripts
        Bash scripts were mostly used to help launch all of the above analyses in a single fell swoop. There are two types of scripts: `.sbatch` files and `.sh` files. `.sbatch` refers to files used to launch larger operations on the Beluga HPC cluster using the slurm scheduler. `.sh` refers to files used to launch operations on a local computer. Identifiable information is removed from both and are meant more as examples to them for your own project.
        - `fingerprinting/bash/fingerprint_launch.sbatch`: Script to launch the fingerprinting. Every fingerprinting calculation can take anywhere from 1h to 10h, depending on the number of nodes and the number of participants to correlate. The script is not parralelized to accelerate the operations, so it was launched using a super-computer (Beluga) where I could assign a single computer for each fingerprinting run to do. 
        - `fingerprinting/bash/fp_launch_args.txt`: The script above requires a file where each line is a set of arguments, specific for a single job. This text file does just that: each line is a specific set of argument to run for a single job, assigned by the `.sbatch` script.
        - `fingerprinting/bash/fpc_iden.sh`: This script takes the R script for fingerprint identification accuracy and launches it for a specific set of arguments.
        - `fingerprinting/bash/fpc_age.sh`: This script takes the R script for self- and others-identifiability with age and launches it for a specific set of arguments.

- Sliding-window - Sample selection
    - Python scripts
        - `sliding_window/sliding_window.py`: Main script containing the functions for the sliding window approach. Currently not supporting command-line arguments directly. This script is an adaptation of Vasa et al. (2018), which was originally done in R.

- Connectome Predictive Modelling
    - Python scripts
        - `connectome_predictive_modelling/python/cpm_python_v2.py`: Main script to use to compute the connectome predictive modelling (CPM) adapted from the original Matlab script by Shen et al. (2017). This script supports many different arguments, some of which are not fully explained in the script yet. This will be fixed in a later release.
        - `connectome_predictive_modelling/r/cpm_performance.Rmd`: Main script used to compute the performance of the CPM. Script it not launchable from the command-line: script is a R markdown. The script specifically produce figures showing the performance of the CPM within each window.
        - `connectome_predictive_modelling/r/proportion_contrib_edges_network.Rmd`: Main script used to compute the proportion of edges contributing to the outcome of interest. Again, it is not launchable from the command-line: script is a R markdown. The script produces figures showing the proportion of edges in each network contributing to the outcome of interest.
        - `connectome_predictive_modelling/bash/launch_cpm.sh`: Small helper script used to launch the main CPM in python script from the command-line.

- Edgewise intraclass correlation
    - Python scripts
        - `edgewise_intraclass_correlation/python/icc_script.py`: Main script computing the ICC based on the method by Amico & Go√±i (2018). Includes command-line launch. **Warning**: The script is not optimized for computing the correlations in parallel. This means that this script can take a long time to run, as it is executing the correlations sequentially. In some tests, it took a minimum of 11h and up to 40h for a single window of 100 participants. Carefully consider the computational ressources before using.
        - `edgewise_intraclass